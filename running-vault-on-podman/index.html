<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Running Vault on Podman | Linuxera</title><meta name=keywords content="vault,secrets,hashicorp,security,podman"><meta name=description content="Running Vault on Podman This post explains how to run a local Vault deployment on Podman for non-production use. I typically use this setup for my lab environments.
This setup was tested with:
Podman v4.7.2 Podman-compose v1.0.6 Vault v1.15.2 Prerequisites Install the vault client, you can get the binary for your O.S here.
curl -L https://releases.hashicorp.com/vault/1.15.2/vault_1.15.2_linux_amd64.zip -o /tmp/vault.zip unzip /tmp/vault.zip && rm -f /tmp/vault.zip sudo mv vault /usr/local/bin/ Generate folder for storing the configs, data, and certs."><meta name=author content="Mario"><link rel=canonical href=https://linuxera.org/running-vault-on-podman/><link crossorigin=anonymous href=/assets/css/stylesheet.8cc7ef3cdd44c5188f9267864f378d8dd8892d583e0fd07b5e5321e496f1e4d1.css integrity="sha256-jMfvPN1ExRiPkmeGTzeNjdiJLVg+D9B7XlMh5Jbx5NE=" rel="preload stylesheet" as=style><link rel=icon href=https://linuxera.org/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://linuxera.org/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://linuxera.org/favicon-32x32.png><link rel=apple-touch-icon href=https://linuxera.org/apple-touch-icon.png><link rel=mask-icon href=https://linuxera.org/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer data-domain=linuxera.org src=https://stats.linuxera.org/js/script.file-downloads.hash.outbound-links.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script><meta property="og:title" content="Running Vault on Podman"><meta property="og:description" content="Running Vault on Podman This post explains how to run a local Vault deployment on Podman for non-production use. I typically use this setup for my lab environments.
This setup was tested with:
Podman v4.7.2 Podman-compose v1.0.6 Vault v1.15.2 Prerequisites Install the vault client, you can get the binary for your O.S here.
curl -L https://releases.hashicorp.com/vault/1.15.2/vault_1.15.2_linux_amd64.zip -o /tmp/vault.zip unzip /tmp/vault.zip && rm -f /tmp/vault.zip sudo mv vault /usr/local/bin/ Generate folder for storing the configs, data, and certs."><meta property="og:type" content="article"><meta property="og:url" content="https://linuxera.org/running-vault-on-podman/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-14T00:00:00+00:00"><meta property="article:modified_time" content="2023-11-14T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Running Vault on Podman"><meta name=twitter:description content="Running Vault on Podman This post explains how to run a local Vault deployment on Podman for non-production use. I typically use this setup for my lab environments.
This setup was tested with:
Podman v4.7.2 Podman-compose v1.0.6 Vault v1.15.2 Prerequisites Install the vault client, you can get the binary for your O.S here.
curl -L https://releases.hashicorp.com/vault/1.15.2/vault_1.15.2_linux_amd64.zip -o /tmp/vault.zip unzip /tmp/vault.zip && rm -f /tmp/vault.zip sudo mv vault /usr/local/bin/ Generate folder for storing the configs, data, and certs."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://linuxera.org/posts/"},{"@type":"ListItem","position":2,"name":"Running Vault on Podman","item":"https://linuxera.org/running-vault-on-podman/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Running Vault on Podman","name":"Running Vault on Podman","description":"Running Vault on Podman This post explains how to run a local Vault deployment on Podman for non-production use. I typically use this setup for my lab environments.\nThis setup was tested with:\nPodman v4.7.2 Podman-compose v1.0.6 Vault v1.15.2 Prerequisites Install the vault client, you can get the binary for your O.S here.\ncurl -L https://releases.hashicorp.com/vault/1.15.2/vault_1.15.2_linux_amd64.zip -o /tmp/vault.zip unzip /tmp/vault.zip \u0026amp;\u0026amp; rm -f /tmp/vault.zip sudo mv vault /usr/local/bin/ Generate folder for storing the configs, data, and certs.","keywords":["vault","secrets","hashicorp","security","podman"],"articleBody":"Running Vault on Podman This post explains how to run a local Vault deployment on Podman for non-production use. I typically use this setup for my lab environments.\nThis setup was tested with:\nPodman v4.7.2 Podman-compose v1.0.6 Vault v1.15.2 Prerequisites Install the vault client, you can get the binary for your O.S here.\ncurl -L https://releases.hashicorp.com/vault/1.15.2/vault_1.15.2_linux_amd64.zip -o /tmp/vault.zip unzip /tmp/vault.zip \u0026\u0026 rm -f /tmp/vault.zip sudo mv vault /usr/local/bin/ Generate folder for storing the configs, data, and certs.\nmkdir -p ${HOME}/vault-server/data/{certs,storage} Generate self-signed cert.\nAttention\nMake sure to edit certificate details to match your environment.\nopenssl req -new -newkey rsa:2048 -sha256 -days 3650 -nodes -x509 -extensions v3_ca -keyout ${HOME}/vault-server/data/certs/private.key -out ${HOME}/vault-server/data/certs/public.crt -subj \"/C=ES/ST=Valencia/L=Valencia/O=Linuxera/OU=Blog/CN=vault.linuxera.org\" -addext \"subjectAltName = DNS:vault.linuxera.org,IP:192.168.122.1\" Configure privileges.\nsudo chmod 777 ${HOME}/vault-server/data/storage sudo chmod 744 ${HOME}/vault-server/data/certs/{private.key,public.crt} At this point you can go for Vault in-memory or for Vault in-disk depending on your data persistency preference.\nVault storage in-memory Generate Vault server config.\ncat \u003c ${HOME}/vault-server/data/in-memory-config.hcl ui = true default_lease_ttl = \"168h\" max_lease_ttl = \"720h\" api_addr = \"https://127.0.0.1:8201\" disable_mlock = true storage \"inmem\" {} listener \"tcp\" { address = \"0.0.0.0:8201\" tls_disable = \"0\" tls_cert_file = \"/data/certs/public.crt\" tls_key_file = \"/data/certs/private.key\" } EOF Generate podman-compose config.\ncat \u003c ${HOME}/vault-server/vault-compose-in-memory.yaml version: '3.6' services: vault: image: docker.io/hashicorp/vault:1.15.2 container_name: vault restart: on-failure:10 ports: - \"8201:8201\" environment: VAULT_ADDR: 'https://0.0.0.0:8201' cap_add: - IPC_LOCK volumes: - $HOME/vault-server/data:/data:rw,Z healthcheck: retries: 5 command: server -config /data/in-memory-config.hcl EOF Run. Once the server is up you can continue reading the section Initialize Vault Server.\nAttention\nThe secrets stored in this Vault instance will be lost once the server is stopped.\npodman-compose -f $HOME/vault-server/vault-compose-in-memory.yaml up -d Stop.\npodman-compose -f $HOME/vault-server/vault-compose-in-memory.yaml down Vault storage in-disk Generate Vault server config.\ncat \u003c ${HOME}/vault-server/data/persistent-config.hcl ui = true default_lease_ttl = \"168h\" max_lease_ttl = \"720h\" api_addr = \"https://127.0.0.1:8201\" disable_mlock = true storage \"file\" { path = \"/data/storage\" } listener \"tcp\" { address = \"0.0.0.0:8201\" tls_disable = \"0\" tls_cert_file = \"/data/certs/public.crt\" tls_key_file = \"/data/certs/private.key\" } EOF Generate podman-compose config.\ncat \u003c ${HOME}/vault-server/vault-compose-file-storage.yaml version: '3.6' services: vault: image: docker.io/hashicorp/vault:1.15.2 container_name: vault restart: on-failure:10 ports: - \"8201:8201\" environment: VAULT_ADDR: 'https://0.0.0.0:8201' cap_add: - IPC_LOCK volumes: - $HOME/vault-server/data:/data:rw,Z healthcheck: retries: 5 command: server -config /data/persistent-config.hcl EOF Run. Once the server is up you can continue reading the section Initialize Vault Server.\npodman-compose -f $HOME/vault-server/vault-compose-file-storage.yaml up -d Stop.\npodman-compose -f $HOME/vault-server/vault-compose-file-storage.yaml down Initialize Vault Server Initialize the Vault.\nNote\nYou can export the VAULT_SKIP_VERIFY env var with its value set to true to ignore self-signed certs.\nexport VAULT_ADDR='https://192.168.122.1:8201' vault operator init | grep -E \"Unseal Key|Initial Root\" \u003e $HOME/vault-server/init-keys.txt Unseal the Vault and login.\nUNSEAL_KEY1=$(grep \"Key 1\" $HOME/vault-server/init-keys.txt | awk -F \": \" '{print $2}') UNSEAL_KEY2=$(grep \"Key 2\" $HOME/vault-server/init-keys.txt | awk -F \": \" '{print $2}') UNSEAL_KEY3=$(grep \"Key 3\" $HOME/vault-server/init-keys.txt | awk -F \": \" '{print $2}') VAULT_TOKEN=$(grep \"Root Token\" $HOME/vault-server/init-keys.txt | awk -F \": \" '{print $2}') vault operator unseal $UNSEAL_KEY1 vault operator unseal $UNSEAL_KEY2 vault operator unseal $UNSEAL_KEY3 vault login $VAULT_TOKEN Enable the kv secrets engine v2.\nvault secrets enable -version=2 kv Configure the ACL for our user.\ncat \u003c $HOME/vault-server/team1.hcl path \"kv/data/team1/*\" { capabilities = [\"create\", \"update\", \"read\", \"delete\", \"list\"] } EOF vault policy write team1-policy $HOME/vault-server/team1.hcl Enable userpass auth and add a user.\nvault auth enable userpass vault write auth/userpass/users/mario password=str0ngp4ss policies=team1-policy Login with the user.\nvault login -method=userpass username=mario password=str0ngp4ss Put a key/value into the Vault.\nvault kv put -mount=kv team1/mysecret foo=a bar=b Get a key/value from the Vault.\nvault kv get -mount=kv team1/mysecret Access the WebUI by pointing your browser to the IP where podman is exposing port 8201. For example https://192.168.122.1:8201/ui.\nUseful Resources Vault Docs Vault Introduction ","wordCount":"594","inLanguage":"en","datePublished":"2023-11-14T00:00:00Z","dateModified":"2023-11-14T00:00:00Z","author":{"@type":"Person","name":"Mario"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://linuxera.org/running-vault-on-podman/"},"publisher":{"@type":"Organization","name":"Linuxera","logo":{"@type":"ImageObject","url":"https://linuxera.org/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://linuxera.org/ accesskey=h title="Linuxera (Alt + H)">Linuxera</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://linuxera.org/ title="🏠 Home"><span>🏠 Home</span></a></li><li><a href=https://linuxera.org/archives/ title="🗄️ Archive"><span>🗄️ Archive</span></a></li><li><a href=https://linuxera.org/search/ title="🔎 Search"><span>🔎 Search</span></a></li><li><a href=https://linuxera.org/tags/ title="🏷️ Tags"><span>🏷️ Tags</span></a></li><li><a href=https://linuxera.org/presentations/ title="🎴 Presentations"><span>🎴 Presentations</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://linuxera.org/>Home</a>&nbsp;»&nbsp;<a href=https://linuxera.org/posts/>Posts</a></div><h1 class=post-title>Running Vault on Podman</h1><div class=post-meta><span title='2023-11-14 00:00:00 +0000 UTC'>Published on November 14, 2023</span>&nbsp;·&nbsp;<span title='2023-11-14 00:00:00 +0000 UTC'>Last updated on November 14, 2023</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Mario</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#running-vault-on-podman aria-label="Running Vault on Podman">Running Vault on Podman</a><ul><li><a href=#prerequisites aria-label=Prerequisites>Prerequisites</a></li><li><a href=#vault-storage-in-memory aria-label="Vault storage in-memory">Vault storage in-memory</a></li><li><a href=#vault-storage-in-disk aria-label="Vault storage in-disk">Vault storage in-disk</a></li><li><a href=#initialize-vault-server aria-label="Initialize Vault Server">Initialize Vault Server</a></li><li><a href=#useful-resources aria-label="Useful Resources">Useful Resources</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=running-vault-on-podman>Running Vault on Podman<a hidden class=anchor aria-hidden=true href=#running-vault-on-podman>#</a></h1><p>This post explains how to run a local Vault deployment on Podman for <strong>non-production</strong> use. I typically use this setup for my lab environments.</p><p>This setup was tested with:</p><ul><li>Podman v4.7.2</li><li>Podman-compose v1.0.6</li><li>Vault v1.15.2</li></ul><h2 id=prerequisites>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites>#</a></h2><ol><li><p>Install the vault client, you can get the binary for your O.S <a href=https://developer.hashicorp.com/vault/install>here</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl -L https://releases.hashicorp.com/vault/1.15.2/vault_1.15.2_linux_amd64.zip -o /tmp/vault.zip
</span></span><span class=line><span class=cl>unzip /tmp/vault.zip <span class=o>&amp;&amp;</span> rm -f /tmp/vault.zip
</span></span><span class=line><span class=cl>sudo mv vault /usr/local/bin/
</span></span></code></pre></div></li><li><p>Generate folder for storing the configs, data, and certs.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mkdir -p <span class=si>${</span><span class=nv>HOME</span><span class=si>}</span>/vault-server/data/<span class=o>{</span>certs,storage<span class=o>}</span>
</span></span></code></pre></div></li><li><p>Generate self-signed cert.</p><div class="admonition attention"><p class=admonition-title>Attention</p><p class=admonition>Make sure to edit certificate details to match your environment.</p></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>openssl req -new -newkey rsa:2048 -sha256 -days <span class=m>3650</span> -nodes -x509 -extensions v3_ca -keyout <span class=si>${</span><span class=nv>HOME</span><span class=si>}</span>/vault-server/data/certs/private.key -out <span class=si>${</span><span class=nv>HOME</span><span class=si>}</span>/vault-server/data/certs/public.crt -subj <span class=s2>&#34;/C=ES/ST=Valencia/L=Valencia/O=Linuxera/OU=Blog/CN=vault.linuxera.org&#34;</span> -addext <span class=s2>&#34;subjectAltName = DNS:vault.linuxera.org,IP:192.168.122.1&#34;</span>
</span></span></code></pre></div></li><li><p>Configure privileges.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo chmod <span class=m>777</span> <span class=si>${</span><span class=nv>HOME</span><span class=si>}</span>/vault-server/data/storage
</span></span><span class=line><span class=cl>sudo chmod <span class=m>744</span> <span class=si>${</span><span class=nv>HOME</span><span class=si>}</span>/vault-server/data/certs/<span class=o>{</span>private.key,public.crt<span class=o>}</span>
</span></span></code></pre></div></li><li><p>At this point you can go for <a href=#vault-storage-in-memory>Vault in-memory</a> or for <a href=#vault-storage-in-disk>Vault in-disk</a> depending on your data persistency preference.</p></li></ol><h2 id=vault-storage-in-memory>Vault storage in-memory<a hidden class=anchor aria-hidden=true href=#vault-storage-in-memory>#</a></h2><ol><li><p>Generate Vault server config.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; ${HOME}/vault-server/data/in-memory-config.hcl
</span></span></span><span class=line><span class=cl><span class=s>ui                = true
</span></span></span><span class=line><span class=cl><span class=s>default_lease_ttl = &#34;168h&#34;
</span></span></span><span class=line><span class=cl><span class=s>max_lease_ttl     = &#34;720h&#34;
</span></span></span><span class=line><span class=cl><span class=s>api_addr          = &#34;https://127.0.0.1:8201&#34;
</span></span></span><span class=line><span class=cl><span class=s>disable_mlock     = true
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>storage &#34;inmem&#34; {}
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>listener &#34;tcp&#34; {
</span></span></span><span class=line><span class=cl><span class=s>  address         = &#34;0.0.0.0:8201&#34;
</span></span></span><span class=line><span class=cl><span class=s>  tls_disable     = &#34;0&#34;
</span></span></span><span class=line><span class=cl><span class=s>  tls_cert_file   = &#34;/data/certs/public.crt&#34;
</span></span></span><span class=line><span class=cl><span class=s>  tls_key_file    = &#34;/data/certs/private.key&#34;
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div></li><li><p>Generate podman-compose config.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; ${HOME}/vault-server/vault-compose-in-memory.yaml
</span></span></span><span class=line><span class=cl><span class=s>version: &#39;3.6&#39;
</span></span></span><span class=line><span class=cl><span class=s>services:
</span></span></span><span class=line><span class=cl><span class=s>  vault:
</span></span></span><span class=line><span class=cl><span class=s>    image: docker.io/hashicorp/vault:1.15.2
</span></span></span><span class=line><span class=cl><span class=s>    container_name: vault
</span></span></span><span class=line><span class=cl><span class=s>    restart: on-failure:10
</span></span></span><span class=line><span class=cl><span class=s>    ports:
</span></span></span><span class=line><span class=cl><span class=s>      - &#34;8201:8201&#34;
</span></span></span><span class=line><span class=cl><span class=s>    environment:
</span></span></span><span class=line><span class=cl><span class=s>      VAULT_ADDR: &#39;https://0.0.0.0:8201&#39;
</span></span></span><span class=line><span class=cl><span class=s>    cap_add:
</span></span></span><span class=line><span class=cl><span class=s>      - IPC_LOCK
</span></span></span><span class=line><span class=cl><span class=s>    volumes:
</span></span></span><span class=line><span class=cl><span class=s>      - $HOME/vault-server/data:/data:rw,Z
</span></span></span><span class=line><span class=cl><span class=s>    healthcheck:
</span></span></span><span class=line><span class=cl><span class=s>      retries: 5
</span></span></span><span class=line><span class=cl><span class=s>    command: server -config /data/in-memory-config.hcl
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div></li><li><p>Run. Once the server is up you can continue reading the section <a href=#initialize-vault-server>Initialize Vault Server</a>.</p><div class="admonition attention"><p class=admonition-title>Attention</p><p class=admonition>The secrets stored in this Vault instance will be lost once the server is stopped.</p></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>podman-compose -f <span class=nv>$HOME</span>/vault-server/vault-compose-in-memory.yaml up -d
</span></span></code></pre></div></li><li><p>Stop.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>podman-compose -f <span class=nv>$HOME</span>/vault-server/vault-compose-in-memory.yaml down
</span></span></code></pre></div></li></ol><h2 id=vault-storage-in-disk>Vault storage in-disk<a hidden class=anchor aria-hidden=true href=#vault-storage-in-disk>#</a></h2><ol><li><p>Generate Vault server config.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; ${HOME}/vault-server/data/persistent-config.hcl
</span></span></span><span class=line><span class=cl><span class=s>ui                = true
</span></span></span><span class=line><span class=cl><span class=s>default_lease_ttl = &#34;168h&#34;
</span></span></span><span class=line><span class=cl><span class=s>max_lease_ttl     = &#34;720h&#34;
</span></span></span><span class=line><span class=cl><span class=s>api_addr          = &#34;https://127.0.0.1:8201&#34;
</span></span></span><span class=line><span class=cl><span class=s>disable_mlock     = true
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>storage &#34;file&#34; { 
</span></span></span><span class=line><span class=cl><span class=s>  path            = &#34;/data/storage&#34;
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>listener &#34;tcp&#34; {
</span></span></span><span class=line><span class=cl><span class=s>  address         = &#34;0.0.0.0:8201&#34;
</span></span></span><span class=line><span class=cl><span class=s>  tls_disable     = &#34;0&#34;
</span></span></span><span class=line><span class=cl><span class=s>  tls_cert_file   = &#34;/data/certs/public.crt&#34;
</span></span></span><span class=line><span class=cl><span class=s>  tls_key_file    = &#34;/data/certs/private.key&#34;
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div></li><li><p>Generate podman-compose config.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; ${HOME}/vault-server/vault-compose-file-storage.yaml
</span></span></span><span class=line><span class=cl><span class=s>version: &#39;3.6&#39;
</span></span></span><span class=line><span class=cl><span class=s>services:
</span></span></span><span class=line><span class=cl><span class=s>  vault:
</span></span></span><span class=line><span class=cl><span class=s>    image: docker.io/hashicorp/vault:1.15.2
</span></span></span><span class=line><span class=cl><span class=s>    container_name: vault
</span></span></span><span class=line><span class=cl><span class=s>    restart: on-failure:10
</span></span></span><span class=line><span class=cl><span class=s>    ports:
</span></span></span><span class=line><span class=cl><span class=s>      - &#34;8201:8201&#34;
</span></span></span><span class=line><span class=cl><span class=s>    environment:
</span></span></span><span class=line><span class=cl><span class=s>      VAULT_ADDR: &#39;https://0.0.0.0:8201&#39;
</span></span></span><span class=line><span class=cl><span class=s>    cap_add:
</span></span></span><span class=line><span class=cl><span class=s>      - IPC_LOCK
</span></span></span><span class=line><span class=cl><span class=s>    volumes:
</span></span></span><span class=line><span class=cl><span class=s>      - $HOME/vault-server/data:/data:rw,Z
</span></span></span><span class=line><span class=cl><span class=s>    healthcheck:
</span></span></span><span class=line><span class=cl><span class=s>      retries: 5
</span></span></span><span class=line><span class=cl><span class=s>    command: server -config /data/persistent-config.hcl
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div></li><li><p>Run. Once the server is up you can continue reading the section <a href=#initialize-vault-server>Initialize Vault Server</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>podman-compose -f <span class=nv>$HOME</span>/vault-server/vault-compose-file-storage.yaml up -d
</span></span></code></pre></div></li><li><p>Stop.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>podman-compose -f <span class=nv>$HOME</span>/vault-server/vault-compose-file-storage.yaml down
</span></span></code></pre></div></li></ol><h2 id=initialize-vault-server>Initialize Vault Server<a hidden class=anchor aria-hidden=true href=#initialize-vault-server>#</a></h2><ol><li><p>Initialize the Vault.</p><div class="admonition tip"><p class=admonition-title>Note</p><p class=admonition>You can export the <code>VAULT_SKIP_VERIFY</code> env var with its value set to <code>true</code> to ignore self-signed certs.</p></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>export</span> <span class=nv>VAULT_ADDR</span><span class=o>=</span><span class=s1>&#39;https://192.168.122.1:8201&#39;</span>
</span></span><span class=line><span class=cl>vault operator init <span class=p>|</span> grep -E <span class=s2>&#34;Unseal Key|Initial Root&#34;</span> &gt; <span class=nv>$HOME</span>/vault-server/init-keys.txt
</span></span></code></pre></div></li><li><p>Unseal the Vault and login.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>UNSEAL_KEY1</span><span class=o>=</span><span class=k>$(</span>grep <span class=s2>&#34;Key 1&#34;</span> <span class=nv>$HOME</span>/vault-server/init-keys.txt <span class=p>|</span> awk -F <span class=s2>&#34;: &#34;</span> <span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>UNSEAL_KEY2</span><span class=o>=</span><span class=k>$(</span>grep <span class=s2>&#34;Key 2&#34;</span> <span class=nv>$HOME</span>/vault-server/init-keys.txt <span class=p>|</span> awk -F <span class=s2>&#34;: &#34;</span> <span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>UNSEAL_KEY3</span><span class=o>=</span><span class=k>$(</span>grep <span class=s2>&#34;Key 3&#34;</span> <span class=nv>$HOME</span>/vault-server/init-keys.txt <span class=p>|</span> awk -F <span class=s2>&#34;: &#34;</span> <span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>VAULT_TOKEN</span><span class=o>=</span><span class=k>$(</span>grep <span class=s2>&#34;Root Token&#34;</span> <span class=nv>$HOME</span>/vault-server/init-keys.txt <span class=p>|</span> awk -F <span class=s2>&#34;: &#34;</span> <span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>vault operator unseal <span class=nv>$UNSEAL_KEY1</span>
</span></span><span class=line><span class=cl>vault operator unseal <span class=nv>$UNSEAL_KEY2</span>
</span></span><span class=line><span class=cl>vault operator unseal <span class=nv>$UNSEAL_KEY3</span>
</span></span><span class=line><span class=cl>vault login <span class=nv>$VAULT_TOKEN</span>   
</span></span></code></pre></div></li><li><p>Enable the kv <a href=https://developer.hashicorp.com/vault/docs/secrets/kv/kv-v2>secrets engine v2</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>vault secrets <span class=nb>enable</span> -version<span class=o>=</span><span class=m>2</span> kv
</span></span></code></pre></div></li><li><p>Configure the ACL for our user.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; $HOME/vault-server/team1.hcl
</span></span></span><span class=line><span class=cl><span class=s>path &#34;kv/data/team1/*&#34; {
</span></span></span><span class=line><span class=cl><span class=s>  capabilities = [&#34;create&#34;, &#34;update&#34;, &#34;read&#34;, &#34;delete&#34;, &#34;list&#34;]
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>vault policy write team1-policy <span class=nv>$HOME</span>/vault-server/team1.hcl
</span></span></code></pre></div></li><li><p>Enable userpass auth and add a user.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>vault auth <span class=nb>enable</span> userpass
</span></span><span class=line><span class=cl>vault write auth/userpass/users/mario <span class=nv>password</span><span class=o>=</span>str0ngp4ss <span class=nv>policies</span><span class=o>=</span>team1-policy
</span></span></code></pre></div></li><li><p>Login with the user.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>vault login -method<span class=o>=</span>userpass <span class=nv>username</span><span class=o>=</span>mario <span class=nv>password</span><span class=o>=</span>str0ngp4ss
</span></span></code></pre></div></li><li><p>Put a key/value into the Vault.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>vault kv put -mount<span class=o>=</span>kv team1/mysecret <span class=nv>foo</span><span class=o>=</span>a <span class=nv>bar</span><span class=o>=</span>b
</span></span></code></pre></div></li><li><p>Get a key/value from the Vault.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>vault kv get -mount<span class=o>=</span>kv team1/mysecret
</span></span></code></pre></div></li><li><p>Access the WebUI by pointing your browser to the IP where podman is exposing port 8201. For example <a href=https://192.168.122.1:8201/ui>https://192.168.122.1:8201/ui</a>.</p></li></ol><h2 id=useful-resources>Useful Resources<a hidden class=anchor aria-hidden=true href=#useful-resources>#</a></h2><ul><li><a href=https://developer.hashicorp.com/vault/docs>Vault Docs</a></li><li><a href=https://developer.hashicorp.com/vault/docs/what-is-vault>Vault Introduction</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://linuxera.org/tags/vault/>vault</a></li><li><a href=https://linuxera.org/tags/secrets/>secrets</a></li><li><a href=https://linuxera.org/tags/hashicorp/>hashicorp</a></li><li><a href=https://linuxera.org/tags/security/>security</a></li><li><a href=https://linuxera.org/tags/podman/>podman</a></li></ul><nav class=paginav><a class=prev href=https://linuxera.org/extending-vxlan-across-nodes-with-wireguard/><span class=title>« Prev</span><br><span>Extending a VXLAN across nodes with Wireguard</span></a>
<a class=next href=https://linuxera.org/integrating-cert-manager-with-cfssl-multirootca/><span class=title>Next »</span><br><span>Integrating cert-manager with CFSSL Multirootca</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Running Vault on Podman on twitter" href="https://twitter.com/intent/tweet/?text=Running%20Vault%20on%20Podman&url=https%3a%2f%2flinuxera.org%2frunning-vault-on-podman%2f&hashtags=vault%2csecrets%2chashicorp%2csecurity%2cpodman"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Running Vault on Podman on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2flinuxera.org%2frunning-vault-on-podman%2f&title=Running%20Vault%20on%20Podman&summary=Running%20Vault%20on%20Podman&source=https%3a%2f%2flinuxera.org%2frunning-vault-on-podman%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></div></footer><div class=share-buttons><p>If this post has been helpful to you, consider <u><a target=_blank href=https://ko-fi.com/mvazce>supporting the work.</a></u></p></div><script src=https://utteranc.es/client.js repo=mvazquezc/mvazquezc.github.io issue-term=pathname label=blog-comments theme=preferred-color-scheme crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://linuxera.org/>Linuxera</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>