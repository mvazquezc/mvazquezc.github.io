<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Enabling Prometheus Metrics on your Applications | Linuxera</title><meta name=keywords content="prometheus,golang,metrics,development"><meta name=description content="Instrumenting your Applications We usually see systems being monitored by Ops teams, in fact, there are lots of valuable metrics that help Ops teams understand how the infrastructure they are managing is doing, but when it comes to applications monitoring, we don&rsquo;t see those being monitored that carefully most of the time. Sometimes that ends up in application crashes that might be prevented with a proper monitoring strategy.
In this blog post we are going to see how we can instrument our applications using Prometheus metrics libraries."><meta name=author content="Mario"><link rel=canonical href=https://linuxera.org/prometheus-metrics-on-your-applications/><link crossorigin=anonymous href=/assets/css/stylesheet.8cc7ef3cdd44c5188f9267864f378d8dd8892d583e0fd07b5e5321e496f1e4d1.css integrity="sha256-jMfvPN1ExRiPkmeGTzeNjdiJLVg+D9B7XlMh5Jbx5NE=" rel="preload stylesheet" as=style><link rel=icon href=https://linuxera.org/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://linuxera.org/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://linuxera.org/favicon-32x32.png><link rel=apple-touch-icon href=https://linuxera.org/apple-touch-icon.png><link rel=mask-icon href=https://linuxera.org/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-7598JKCK1E"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-7598JKCK1E",{anonymize_ip:!1})}</script><meta property="og:title" content="Enabling Prometheus Metrics on your Applications"><meta property="og:description" content="Instrumenting your Applications We usually see systems being monitored by Ops teams, in fact, there are lots of valuable metrics that help Ops teams understand how the infrastructure they are managing is doing, but when it comes to applications monitoring, we don&rsquo;t see those being monitored that carefully most of the time. Sometimes that ends up in application crashes that might be prevented with a proper monitoring strategy.
In this blog post we are going to see how we can instrument our applications using Prometheus metrics libraries."><meta property="og:type" content="article"><meta property="og:url" content="https://linuxera.org/prometheus-metrics-on-your-applications/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-11T00:00:00+00:00"><meta property="article:modified_time" content="2019-08-11T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Enabling Prometheus Metrics on your Applications"><meta name=twitter:description content="Instrumenting your Applications We usually see systems being monitored by Ops teams, in fact, there are lots of valuable metrics that help Ops teams understand how the infrastructure they are managing is doing, but when it comes to applications monitoring, we don&rsquo;t see those being monitored that carefully most of the time. Sometimes that ends up in application crashes that might be prevented with a proper monitoring strategy.
In this blog post we are going to see how we can instrument our applications using Prometheus metrics libraries."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://linuxera.org/posts/"},{"@type":"ListItem","position":2,"name":"Enabling Prometheus Metrics on your Applications","item":"https://linuxera.org/prometheus-metrics-on-your-applications/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Enabling Prometheus Metrics on your Applications","name":"Enabling Prometheus Metrics on your Applications","description":"Instrumenting your Applications We usually see systems being monitored by Ops teams, in fact, there are lots of valuable metrics that help Ops teams understand how the infrastructure they are managing is doing, but when it comes to applications monitoring, we don\u0026rsquo;t see those being monitored that carefully most of the time. Sometimes that ends up in application crashes that might be prevented with a proper monitoring strategy.\nIn this blog post we are going to see how we can instrument our applications using Prometheus metrics libraries.","keywords":["prometheus","golang","metrics","development"],"articleBody":"Instrumenting your Applications We usually see systems being monitored by Ops teams, in fact, there are lots of valuable metrics that help Ops teams understand how the infrastructure they are managing is doing, but when it comes to applications monitoring, we don‚Äôt see those being monitored that carefully most of the time. Sometimes that ends up in application crashes that might be prevented with a proper monitoring strategy.\nIn this blog post we are going to see how we can instrument our applications using Prometheus metrics libraries. Prometheus metrics libraries are widely adopted, the Prometheus metrics format has become an independent project, OpenMetrics. OpenMetrics is trying to take Prometheus Metrics Format to the next level making it an industry standard.\nCustom Metrics Example In this example we are going to use our Simple Go Application as a reference.\nOur example application is capable of:\nReverses a word sent via POST on / endpoint Returns a release version set via an env var on / endpoint Returns the hostname of the machine where it‚Äôs running on /hostname endpoint Returns the app status on /health endpoint We are going to add the following metrics to our application:\nTotal number of words that have been reversed by our application Total number of times that a given endpoint has been accessed NOTE: This is an example application with example metrics, you should think carefully of which metrics do you want to include in your production applications.\nPrometheus Client The Prometheus Client is available for multiple programming languages, for today‚Äôs blog post we will be using the Go Client.\nThe Prometheus Client provides some metrics enabled by default, among those metrics we can find metrics related to memory consumption, cpu consumption, etc.\nEnable Prometheus Metrics Endpoint NOTE: Make sure you‚Äôre following metrics name best practices when defining your metrics.\nFirst, we need to import some required modules:\n\"github.com/prometheus/client_golang/prometheus\" \"github.com/prometheus/client_golang/prometheus/promhttp\" Define reversewords_reversed_words_total metric. This metric is a simple counter metric.\nvar ( totalWordsReversed = prometheus.NewCounter( prometheus.CounterOpts{ Name: \"reversewords_reversed_words_total\", Help: \"Total number of reversed words\", }, ) ) Define reversewords_endpoints_accessed_total metric. This metric is a vector counter metric.\nvar ( endpointsAccessed = prometheus.NewCounterVec( prometheus.CounterOpts{ Name: \"reversewords_endpoints_accessed_total\", Help: \"Total number of accessed to a given endpoint\", }, []string{\"accessed_endpoint\"}, ) ) Our application has 4 different endpoints as we already seen before, these are the endpoints:\nrouter.HandleFunc(\"/\", ReverseWord).Methods(\"POST\") router.HandleFunc(\"/\", ReturnRelease).Methods(\"GET\") router.HandleFunc(\"/hostname\", ReturnHostname).Methods(\"GET\") router.HandleFunc(\"/health\", ReturnHealth).Methods(\"GET\") The reversewords_reversed_words_total metric will be increased every time the function ReverseWord is called:\nfunc ReverseWord(w http.ResponseWriter, r *http.Request) { \u003cOUTPUT_OMITTED\u003e totalWordsReversed.Inc() \u003cOUTPUT_OMITTED\u003e } The reversewords_endpoints_accessed_total metric will be increased every time the functions ReverseWord, ReturnRelease, ReturnHostname or ReturnHealth are called:\nfunc ReturnRelease(w http.ResponseWriter, r *http.Request) { \u003cOUTPUT_OMITTED\u003e endpointsAccessed.WithLabelValues(\"release\").Inc() } func ReturnHostname(w http.ResponseWriter, r *http.Request) { \u003cOUTPUT_OMITTED\u003e endpointsAccessed.WithLabelValues(\"hostname\").Inc() } func ReturnHealth(w http.ResponseWriter, r *http.Request) { \u003cOUTPUT_OMITTED\u003e endpointsAccessed.WithLabelValues(\"health\").Inc() } func ReverseWord(w http.ResponseWriter, r *http.Request) { \u003cOUTPUT_OMITTED\u003e endpointsAccessed.WithLabelValues(\"reverseword\").Inc() } Finally, we need to add the /metrics endpoint to our application:\nrouter.Handle(\"/metrics\", promhttp.Handler()).Methods(\"GET\") Gathering Metrics With our application running we can send a GET request to the /metrics endpoints to get the metrics:\n$ curl http://127.0.0.1:8080/metrics # HELP go_gc_duration_seconds A summary of the GC invocation durations. # TYPE go_gc_duration_seconds summary go_gc_duration_seconds{quantile=\"0\"} 0 go_gc_duration_seconds{quantile=\"0.25\"} 0 go_gc_duration_seconds{quantile=\"0.5\"} 0 go_gc_duration_seconds{quantile=\"0.75\"} 0 go_gc_duration_seconds{quantile=\"1\"} 0 go_gc_duration_seconds_sum 0 go_gc_duration_seconds_count 0 # HELP go_goroutines Number of goroutines that currently exist. # TYPE go_goroutines gauge go_goroutines 8 # HELP go_info Information about the Go environment. # TYPE go_info gauge go_info{version=\"go1.12.6\"} 1 # HELP go_memstats_alloc_bytes Number of bytes allocated and still in use. # TYPE go_memstats_alloc_bytes gauge go_memstats_alloc_bytes 457776 # HELP go_memstats_alloc_bytes_total Total number of bytes allocated, even if freed. # TYPE go_memstats_alloc_bytes_total counter go_memstats_alloc_bytes_total 457776 # HELP go_memstats_buck_hash_sys_bytes Number of bytes used by the profiling bucket hash table. # TYPE go_memstats_buck_hash_sys_bytes gauge go_memstats_buck_hash_sys_bytes 2684 # HELP go_memstats_frees_total Total number of frees. # TYPE go_memstats_frees_total counter go_memstats_frees_total 172 # HELP go_memstats_gc_cpu_fraction The fraction of this program's available CPU time used by the GC since the program started. # TYPE go_memstats_gc_cpu_fraction gauge go_memstats_gc_cpu_fraction 0 # HELP go_memstats_gc_sys_bytes Number of bytes used for garbage collection system metadata. # TYPE go_memstats_gc_sys_bytes gauge go_memstats_gc_sys_bytes 2.240512e+06 # HELP go_memstats_heap_alloc_bytes Number of heap bytes allocated and still in use. # TYPE go_memstats_heap_alloc_bytes gauge go_memstats_heap_alloc_bytes 457776 # HELP go_memstats_heap_idle_bytes Number of heap bytes waiting to be used. # TYPE go_memstats_heap_idle_bytes gauge go_memstats_heap_idle_bytes 6.5347584e+07 # HELP go_memstats_heap_inuse_bytes Number of heap bytes that are in use. # TYPE go_memstats_heap_inuse_bytes gauge go_memstats_heap_inuse_bytes 1.368064e+06 # HELP go_memstats_heap_objects Number of allocated objects. # TYPE go_memstats_heap_objects gauge go_memstats_heap_objects 2079 # HELP go_memstats_heap_released_bytes Number of heap bytes released to OS. # TYPE go_memstats_heap_released_bytes gauge go_memstats_heap_released_bytes 0 # HELP go_memstats_heap_sys_bytes Number of heap bytes obtained from system. # TYPE go_memstats_heap_sys_bytes gauge go_memstats_heap_sys_bytes 6.6715648e+07 # HELP go_memstats_last_gc_time_seconds Number of seconds since 1970 of last garbage collection. # TYPE go_memstats_last_gc_time_seconds gauge go_memstats_last_gc_time_seconds 0 # HELP go_memstats_lookups_total Total number of pointer lookups. # TYPE go_memstats_lookups_total counter go_memstats_lookups_total 0 # HELP go_memstats_mallocs_total Total number of mallocs. # TYPE go_memstats_mallocs_total counter go_memstats_mallocs_total 2251 # HELP go_memstats_mcache_inuse_bytes Number of bytes in use by mcache structures. # TYPE go_memstats_mcache_inuse_bytes gauge go_memstats_mcache_inuse_bytes 6944 # HELP go_memstats_mcache_sys_bytes Number of bytes used for mcache structures obtained from system. # TYPE go_memstats_mcache_sys_bytes gauge go_memstats_mcache_sys_bytes 16384 # HELP go_memstats_mspan_inuse_bytes Number of bytes in use by mspan structures. # TYPE go_memstats_mspan_inuse_bytes gauge go_memstats_mspan_inuse_bytes 19440 # HELP go_memstats_mspan_sys_bytes Number of bytes used for mspan structures obtained from system. # TYPE go_memstats_mspan_sys_bytes gauge go_memstats_mspan_sys_bytes 32768 # HELP go_memstats_next_gc_bytes Number of heap bytes when next garbage collection will take place. # TYPE go_memstats_next_gc_bytes gauge go_memstats_next_gc_bytes 4.473924e+06 # HELP go_memstats_other_sys_bytes Number of bytes used for other system allocations. # TYPE go_memstats_other_sys_bytes gauge go_memstats_other_sys_bytes 527748 # HELP go_memstats_stack_inuse_bytes Number of bytes in use by the stack allocator. # TYPE go_memstats_stack_inuse_bytes gauge go_memstats_stack_inuse_bytes 393216 # HELP go_memstats_stack_sys_bytes Number of bytes obtained from system for stack allocator. # TYPE go_memstats_stack_sys_bytes gauge go_memstats_stack_sys_bytes 393216 # HELP go_memstats_sys_bytes Number of bytes obtained from system. # TYPE go_memstats_sys_bytes gauge go_memstats_sys_bytes 6.992896e+07 # HELP go_threads Number of OS threads created. # TYPE go_threads gauge go_threads 8 # HELP process_cpu_seconds_total Total user and system CPU time spent in seconds. # TYPE process_cpu_seconds_total counter process_cpu_seconds_total 0 # HELP process_max_fds Maximum number of open file descriptors. # TYPE process_max_fds gauge process_max_fds 1024 # HELP process_open_fds Number of open file descriptors. # TYPE process_open_fds gauge process_open_fds 7 # HELP process_resident_memory_bytes Resident memory size in bytes. # TYPE process_resident_memory_bytes gauge process_resident_memory_bytes 7.548928e+06 # HELP process_start_time_seconds Start time of the process since unix epoch in seconds. # TYPE process_start_time_seconds gauge process_start_time_seconds 1.56553026534e+09 # HELP process_virtual_memory_bytes Virtual memory size in bytes. # TYPE process_virtual_memory_bytes gauge process_virtual_memory_bytes 5.00559872e+08 # HELP process_virtual_memory_max_bytes Maximum amount of virtual memory available in bytes. # TYPE process_virtual_memory_max_bytes gauge process_virtual_memory_max_bytes -1 # HELP promhttp_metric_handler_requests_in_flight Current number of scrapes being served. # TYPE promhttp_metric_handler_requests_in_flight gauge promhttp_metric_handler_requests_in_flight 1 # HELP promhttp_metric_handler_requests_total Total number of scrapes by HTTP status code. # TYPE promhttp_metric_handler_requests_total counter promhttp_metric_handler_requests_total{code=\"200\"} 0 promhttp_metric_handler_requests_total{code=\"500\"} 0 promhttp_metric_handler_requests_total{code=\"503\"} 0 # HELP reversewords_reversed_words_total Total number of reversed words # TYPE reversewords_reversed_words_total counter reversewords_reversed_words_total 0 Now, let‚Äôs see how our metrics increase as we use our application:\n$ curl -s http://127.0.0.1:8080/ -X POST -d '{\"word\":\"PALC\"}' {\"reverse_word\":\"CLAP\"} $ curl -s http://127.0.0.1:8080/health Healthy $ curl -s http://127.0.0.1:8080/hostname Hostname: reverse-words-22j33j $ curl -s http://127.0.0.1:8080/metrics | grep \"reversewords_\" # HELP reversewords_endpoints_accessed_total Total number of accessed to a given endpoint # TYPE reversewords_endpoints_accessed_total counter reversewords_endpoints_accessed_total{accessed_endpoint=\"health\"} 1 reversewords_endpoints_accessed_total{accessed_endpoint=\"hostname\"} 1 reversewords_endpoints_accessed_total{accessed_endpoint=\"reverseword\"} 1 # HELP reversewords_reversed_words_total Total number of reversed words # TYPE reversewords_reversed_words_total counter reversewords_reversed_words_total 1 As you can see the reversewords_reversed_words_total has increased by 1 and the reversewords_endpoints_accessed_total metrics now show the total number of times a given endpoint has been accessed.\nNext Steps In a future blog post we are going to show how we can configure Prometheus to scrape our metrics endpoint and how Grafana can help us to create graphs that can be consumed by monitoring teams.\nUseful Resources If you want to learn more, feel free to take a look at the resources below.\nhttps://sysdig.com/blog/prometheus-metrics/ https://prometheus.io/docs/guides/go-application/ ","wordCount":"1309","inLanguage":"en","datePublished":"2019-08-11T00:00:00Z","dateModified":"2019-08-11T00:00:00Z","author":{"@type":"Person","name":"Mario"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://linuxera.org/prometheus-metrics-on-your-applications/"},"publisher":{"@type":"Organization","name":"Linuxera","logo":{"@type":"ImageObject","url":"https://linuxera.org/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://linuxera.org/ accesskey=h title="Linuxera (Alt + H)">Linuxera</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://linuxera.org/ title="üè† Home"><span>üè† Home</span></a></li><li><a href=https://linuxera.org/archives/ title="üóÑÔ∏è Archive"><span>üóÑÔ∏è Archive</span></a></li><li><a href=https://linuxera.org/search/ title="üîé Search"><span>üîé Search</span></a></li><li><a href=https://linuxera.org/tags/ title="üè∑Ô∏è Tags"><span>üè∑Ô∏è Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://linuxera.org/>Home</a>&nbsp;¬ª&nbsp;<a href=https://linuxera.org/posts/>Posts</a></div><h1 class=post-title>Enabling Prometheus Metrics on your Applications</h1><div class=post-meta><span title='2019-08-11 00:00:00 +0000 UTC'>Published on August 11, 2019</span>&nbsp;¬∑&nbsp;<span title='2019-08-11 00:00:00 +0000 UTC'>Last updated on August 11, 2019</span>&nbsp;¬∑&nbsp;7 min&nbsp;¬∑&nbsp;Mario</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#instrumenting-your-applications aria-label="Instrumenting your Applications">Instrumenting your Applications</a><ul><li><a href=#custom-metrics-example aria-label="Custom Metrics Example">Custom Metrics Example</a></li><li><a href=#prometheus-client aria-label="Prometheus Client">Prometheus Client</a></li><li><a href=#enable-prometheus-metrics-endpoint aria-label="Enable Prometheus Metrics Endpoint">Enable Prometheus Metrics Endpoint</a></li><li><a href=#gathering-metrics aria-label="Gathering Metrics">Gathering Metrics</a></li></ul></li><li><a href=#next-steps aria-label="Next Steps">Next Steps</a></li><li><a href=#useful-resources aria-label="Useful Resources">Useful Resources</a></li></ul></div></details></div><div class=post-content><h1 id=instrumenting-your-applications>Instrumenting your Applications<a hidden class=anchor aria-hidden=true href=#instrumenting-your-applications>#</a></h1><p>We usually see systems being monitored by Ops teams, in fact, there are lots of valuable metrics that help Ops teams understand how the infrastructure they are managing is doing, but when it comes to applications monitoring, we don&rsquo;t see those being monitored that carefully most of the time. Sometimes that ends up in application crashes that might be prevented with a proper monitoring strategy.</p><p>In this blog post we are going to see how we can instrument our applications using <strong>Prometheus metrics libraries</strong>. Prometheus metrics libraries are widely adopted, the Prometheus metrics format has become an independent project, OpenMetrics. OpenMetrics is trying to take Prometheus Metrics Format to the next level making it an industry standard.</p><h2 id=custom-metrics-example>Custom Metrics Example<a hidden class=anchor aria-hidden=true href=#custom-metrics-example>#</a></h2><p>In this example we are going to use our <a href=https://github.com/mvazquezc/reverse-words>Simple Go Application</a> as a reference.</p><p>Our example application is capable of:</p><ul><li>Reverses a word sent via POST on <code>/</code> endpoint</li><li>Returns a release version set via an env var on <code>/</code> endpoint</li><li>Returns the hostname of the machine where it&rsquo;s running on <code>/hostname</code> endpoint</li><li>Returns the app status on <code>/health</code> endpoint</li></ul><p>We are going to add the following metrics to our application:</p><ul><li>Total number of words that have been reversed by our application</li><li>Total number of times that a given endpoint has been accessed</li></ul><blockquote><p><strong>NOTE</strong>: This is an example application with example metrics, you should think carefully of which metrics do you want to include in your production applications.</p></blockquote><h2 id=prometheus-client>Prometheus Client<a hidden class=anchor aria-hidden=true href=#prometheus-client>#</a></h2><p>The <a href=https://prometheus.io/docs/instrumenting/clientlibs/>Prometheus Client</a> is available for multiple programming languages, for today&rsquo;s blog post we will be using the <a href=https://github.com/prometheus/client_golang>Go Client</a>.</p><p>The <code>Prometheus Client</code> provides some metrics enabled by default, among those metrics we can find metrics related to memory consumption, cpu consumption, etc.</p><h2 id=enable-prometheus-metrics-endpoint>Enable Prometheus Metrics Endpoint<a hidden class=anchor aria-hidden=true href=#enable-prometheus-metrics-endpoint>#</a></h2><blockquote><p><strong>NOTE</strong>: Make sure you&rsquo;re following <a href=https://prometheus.io/docs/practices/naming/#metric-names>metrics name best practices</a> when defining your metrics.</p></blockquote><ol><li><p>First, we need to import some required modules:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=s>&#34;github.com/prometheus/client_golang/prometheus&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;github.com/prometheus/client_golang/prometheus/promhttp&#34;</span>
</span></span></code></pre></div></li><li><p>Define <code>reversewords_reversed_words_total</code> metric. This metric is a simple counter metric.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>totalWordsReversed</span> <span class=p>=</span> <span class=nx>prometheus</span><span class=p>.</span><span class=nf>NewCounter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	    <span class=nx>prometheus</span><span class=p>.</span><span class=nx>CounterOpts</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		    <span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;reversewords_reversed_words_total&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		    <span class=nx>Help</span><span class=p>:</span> <span class=s>&#34;Total number of reversed words&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div></li><li><p>Define <code>reversewords_endpoints_accessed_total</code> metric. This metric is a vector counter metric.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>endpointsAccessed</span> <span class=p>=</span> <span class=nx>prometheus</span><span class=p>.</span><span class=nf>NewCounterVec</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	    <span class=nx>prometheus</span><span class=p>.</span><span class=nx>CounterOpts</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		    <span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;reversewords_endpoints_accessed_total&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		    <span class=nx>Help</span><span class=p>:</span> <span class=s>&#34;Total number of accessed to a given endpoint&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	    <span class=p>},</span>
</span></span><span class=line><span class=cl>	    <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;accessed_endpoint&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div></li><li><p>Our application has 4 different endpoints as we already seen before, these are the endpoints:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span> <span class=nx>ReverseWord</span><span class=p>).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;POST&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span> <span class=nx>ReturnRelease</span><span class=p>).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;GET&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/hostname&#34;</span><span class=p>,</span> <span class=nx>ReturnHostname</span><span class=p>).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;GET&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/health&#34;</span><span class=p>,</span> <span class=nx>ReturnHealth</span><span class=p>).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;GET&#34;</span><span class=p>)</span>
</span></span></code></pre></div></li><li><p>The <code>reversewords_reversed_words_total</code> metric will be increased every time the function <code>ReverseWord</code> is called:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>ReverseWord</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=p>&lt;</span><span class=nx>OUTPUT_OMITTED</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>totalWordsReversed</span><span class=p>.</span><span class=nf>Inc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>   <span class=p>&lt;</span><span class=nx>OUTPUT_OMITTED</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li><li><p>The <code>reversewords_endpoints_accessed_total</code> metric will be increased every time the functions <code>ReverseWord</code>, <code>ReturnRelease</code>, <code>ReturnHostname</code> or <code>ReturnHealth</code> are called:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>ReturnRelease</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nx>OUTPUT_OMITTED</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>endpointsAccessed</span><span class=p>.</span><span class=nf>WithLabelValues</span><span class=p>(</span><span class=s>&#34;release&#34;</span><span class=p>).</span><span class=nf>Inc</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>ReturnHostname</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nx>OUTPUT_OMITTED</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>endpointsAccessed</span><span class=p>.</span><span class=nf>WithLabelValues</span><span class=p>(</span><span class=s>&#34;hostname&#34;</span><span class=p>).</span><span class=nf>Inc</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>ReturnHealth</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nx>OUTPUT_OMITTED</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>endpointsAccessed</span><span class=p>.</span><span class=nf>WithLabelValues</span><span class=p>(</span><span class=s>&#34;health&#34;</span><span class=p>).</span><span class=nf>Inc</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>ReverseWord</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nx>OUTPUT_OMITTED</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>endpointsAccessed</span><span class=p>.</span><span class=nf>WithLabelValues</span><span class=p>(</span><span class=s>&#34;reverseword&#34;</span><span class=p>).</span><span class=nf>Inc</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li><li><p>Finally, we need to add the <code>/metrics</code> endpoint to our application:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nf>Handle</span><span class=p>(</span><span class=s>&#34;/metrics&#34;</span><span class=p>,</span> <span class=nx>promhttp</span><span class=p>.</span><span class=nf>Handler</span><span class=p>()).</span><span class=nf>Methods</span><span class=p>(</span><span class=s>&#34;GET&#34;</span><span class=p>)</span>
</span></span></code></pre></div></li></ol><h2 id=gathering-metrics>Gathering Metrics<a hidden class=anchor aria-hidden=true href=#gathering-metrics>#</a></h2><p>With our application running we can send a GET request to the <code>/metrics</code> endpoints to get the metrics:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ curl http://127.0.0.1:8080/metrics
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># HELP go_gc_duration_seconds A summary of the GC invocation durations.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_gc_duration_seconds summary</span>
</span></span><span class=line><span class=cl>go_gc_duration_seconds<span class=o>{</span><span class=nv>quantile</span><span class=o>=</span><span class=s2>&#34;0&#34;</span><span class=o>}</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>go_gc_duration_seconds<span class=o>{</span><span class=nv>quantile</span><span class=o>=</span><span class=s2>&#34;0.25&#34;</span><span class=o>}</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>go_gc_duration_seconds<span class=o>{</span><span class=nv>quantile</span><span class=o>=</span><span class=s2>&#34;0.5&#34;</span><span class=o>}</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>go_gc_duration_seconds<span class=o>{</span><span class=nv>quantile</span><span class=o>=</span><span class=s2>&#34;0.75&#34;</span><span class=o>}</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>go_gc_duration_seconds<span class=o>{</span><span class=nv>quantile</span><span class=o>=</span><span class=s2>&#34;1&#34;</span><span class=o>}</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>go_gc_duration_seconds_sum <span class=m>0</span>
</span></span><span class=line><span class=cl>go_gc_duration_seconds_count <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_goroutines Number of goroutines that currently exist.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_goroutines gauge</span>
</span></span><span class=line><span class=cl>go_goroutines <span class=m>8</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_info Information about the Go environment.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_info gauge</span>
</span></span><span class=line><span class=cl>go_info<span class=o>{</span><span class=nv>version</span><span class=o>=</span><span class=s2>&#34;go1.12.6&#34;</span><span class=o>}</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_alloc_bytes Number of bytes allocated and still in use.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_alloc_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_alloc_bytes <span class=m>457776</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_alloc_bytes_total Total number of bytes allocated, even if freed.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_alloc_bytes_total counter</span>
</span></span><span class=line><span class=cl>go_memstats_alloc_bytes_total <span class=m>457776</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_buck_hash_sys_bytes Number of bytes used by the profiling bucket hash table.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_buck_hash_sys_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_buck_hash_sys_bytes <span class=m>2684</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_frees_total Total number of frees.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_frees_total counter</span>
</span></span><span class=line><span class=cl>go_memstats_frees_total <span class=m>172</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_gc_cpu_fraction The fraction of this program&#39;s available CPU time used by the GC since the program started.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_gc_cpu_fraction gauge</span>
</span></span><span class=line><span class=cl>go_memstats_gc_cpu_fraction <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_gc_sys_bytes Number of bytes used for garbage collection system metadata.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_gc_sys_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_gc_sys_bytes 2.240512e+06
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_heap_alloc_bytes Number of heap bytes allocated and still in use.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_heap_alloc_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_heap_alloc_bytes <span class=m>457776</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_heap_idle_bytes Number of heap bytes waiting to be used.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_heap_idle_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_heap_idle_bytes 6.5347584e+07
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_heap_inuse_bytes Number of heap bytes that are in use.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_heap_inuse_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_heap_inuse_bytes 1.368064e+06
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_heap_objects Number of allocated objects.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_heap_objects gauge</span>
</span></span><span class=line><span class=cl>go_memstats_heap_objects <span class=m>2079</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_heap_released_bytes Number of heap bytes released to OS.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_heap_released_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_heap_released_bytes <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_heap_sys_bytes Number of heap bytes obtained from system.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_heap_sys_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_heap_sys_bytes 6.6715648e+07
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_last_gc_time_seconds Number of seconds since 1970 of last garbage collection.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_last_gc_time_seconds gauge</span>
</span></span><span class=line><span class=cl>go_memstats_last_gc_time_seconds <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_lookups_total Total number of pointer lookups.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_lookups_total counter</span>
</span></span><span class=line><span class=cl>go_memstats_lookups_total <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_mallocs_total Total number of mallocs.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_mallocs_total counter</span>
</span></span><span class=line><span class=cl>go_memstats_mallocs_total <span class=m>2251</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_mcache_inuse_bytes Number of bytes in use by mcache structures.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_mcache_inuse_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_mcache_inuse_bytes <span class=m>6944</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_mcache_sys_bytes Number of bytes used for mcache structures obtained from system.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_mcache_sys_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_mcache_sys_bytes <span class=m>16384</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_mspan_inuse_bytes Number of bytes in use by mspan structures.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_mspan_inuse_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_mspan_inuse_bytes <span class=m>19440</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_mspan_sys_bytes Number of bytes used for mspan structures obtained from system.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_mspan_sys_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_mspan_sys_bytes <span class=m>32768</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_next_gc_bytes Number of heap bytes when next garbage collection will take place.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_next_gc_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_next_gc_bytes 4.473924e+06
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_other_sys_bytes Number of bytes used for other system allocations.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_other_sys_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_other_sys_bytes <span class=m>527748</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_stack_inuse_bytes Number of bytes in use by the stack allocator.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_stack_inuse_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_stack_inuse_bytes <span class=m>393216</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_stack_sys_bytes Number of bytes obtained from system for stack allocator.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_stack_sys_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_stack_sys_bytes <span class=m>393216</span>
</span></span><span class=line><span class=cl><span class=c1># HELP go_memstats_sys_bytes Number of bytes obtained from system.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_memstats_sys_bytes gauge</span>
</span></span><span class=line><span class=cl>go_memstats_sys_bytes 6.992896e+07
</span></span><span class=line><span class=cl><span class=c1># HELP go_threads Number of OS threads created.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE go_threads gauge</span>
</span></span><span class=line><span class=cl>go_threads <span class=m>8</span>
</span></span><span class=line><span class=cl><span class=c1># HELP process_cpu_seconds_total Total user and system CPU time spent in seconds.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE process_cpu_seconds_total counter</span>
</span></span><span class=line><span class=cl>process_cpu_seconds_total <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=c1># HELP process_max_fds Maximum number of open file descriptors.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE process_max_fds gauge</span>
</span></span><span class=line><span class=cl>process_max_fds <span class=m>1024</span>
</span></span><span class=line><span class=cl><span class=c1># HELP process_open_fds Number of open file descriptors.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE process_open_fds gauge</span>
</span></span><span class=line><span class=cl>process_open_fds <span class=m>7</span>
</span></span><span class=line><span class=cl><span class=c1># HELP process_resident_memory_bytes Resident memory size in bytes.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE process_resident_memory_bytes gauge</span>
</span></span><span class=line><span class=cl>process_resident_memory_bytes 7.548928e+06
</span></span><span class=line><span class=cl><span class=c1># HELP process_start_time_seconds Start time of the process since unix epoch in seconds.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE process_start_time_seconds gauge</span>
</span></span><span class=line><span class=cl>process_start_time_seconds 1.56553026534e+09
</span></span><span class=line><span class=cl><span class=c1># HELP process_virtual_memory_bytes Virtual memory size in bytes.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE process_virtual_memory_bytes gauge</span>
</span></span><span class=line><span class=cl>process_virtual_memory_bytes 5.00559872e+08
</span></span><span class=line><span class=cl><span class=c1># HELP process_virtual_memory_max_bytes Maximum amount of virtual memory available in bytes.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE process_virtual_memory_max_bytes gauge</span>
</span></span><span class=line><span class=cl>process_virtual_memory_max_bytes -1
</span></span><span class=line><span class=cl><span class=c1># HELP promhttp_metric_handler_requests_in_flight Current number of scrapes being served.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE promhttp_metric_handler_requests_in_flight gauge</span>
</span></span><span class=line><span class=cl>promhttp_metric_handler_requests_in_flight <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=c1># HELP promhttp_metric_handler_requests_total Total number of scrapes by HTTP status code.</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE promhttp_metric_handler_requests_total counter</span>
</span></span><span class=line><span class=cl>promhttp_metric_handler_requests_total<span class=o>{</span><span class=nv>code</span><span class=o>=</span><span class=s2>&#34;200&#34;</span><span class=o>}</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>promhttp_metric_handler_requests_total<span class=o>{</span><span class=nv>code</span><span class=o>=</span><span class=s2>&#34;500&#34;</span><span class=o>}</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>promhttp_metric_handler_requests_total<span class=o>{</span><span class=nv>code</span><span class=o>=</span><span class=s2>&#34;503&#34;</span><span class=o>}</span> <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=c1># HELP reversewords_reversed_words_total Total number of reversed words</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE reversewords_reversed_words_total counter</span>
</span></span><span class=line><span class=cl>reversewords_reversed_words_total <span class=m>0</span>
</span></span></code></pre></div><p>Now, let&rsquo;s see how our metrics increase as we use our application:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ curl -s http://127.0.0.1:8080/ -X POST -d <span class=s1>&#39;{&#34;word&#34;:&#34;PALC&#34;}&#39;</span>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;reverse_word&#34;</span>:<span class=s2>&#34;CLAP&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ curl -s http://127.0.0.1:8080/health
</span></span><span class=line><span class=cl>Healthy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ curl -s http://127.0.0.1:8080/hostname
</span></span><span class=line><span class=cl>Hostname: reverse-words-22j33j
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ curl -s http://127.0.0.1:8080/metrics <span class=p>|</span> grep <span class=s2>&#34;reversewords_&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># HELP reversewords_endpoints_accessed_total Total number of accessed to a given endpoint</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE reversewords_endpoints_accessed_total counter</span>
</span></span><span class=line><span class=cl>reversewords_endpoints_accessed_total<span class=o>{</span><span class=nv>accessed_endpoint</span><span class=o>=</span><span class=s2>&#34;health&#34;</span><span class=o>}</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>reversewords_endpoints_accessed_total<span class=o>{</span><span class=nv>accessed_endpoint</span><span class=o>=</span><span class=s2>&#34;hostname&#34;</span><span class=o>}</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>reversewords_endpoints_accessed_total<span class=o>{</span><span class=nv>accessed_endpoint</span><span class=o>=</span><span class=s2>&#34;reverseword&#34;</span><span class=o>}</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=c1># HELP reversewords_reversed_words_total Total number of reversed words</span>
</span></span><span class=line><span class=cl><span class=c1># TYPE reversewords_reversed_words_total counter</span>
</span></span><span class=line><span class=cl>reversewords_reversed_words_total <span class=m>1</span>
</span></span></code></pre></div><p>As you can see the <code>reversewords_reversed_words_total</code> has increased by 1 and the <code>reversewords_endpoints_accessed_total</code> metrics now show the total number of times a given endpoint has been accessed.</p><h1 id=next-steps>Next Steps<a hidden class=anchor aria-hidden=true href=#next-steps>#</a></h1><p>In a future blog post we are going to show how we can configure Prometheus to scrape our metrics endpoint and how Grafana can help us to create graphs that can be consumed by monitoring teams.</p><h1 id=useful-resources>Useful Resources<a hidden class=anchor aria-hidden=true href=#useful-resources>#</a></h1><p>If you want to learn more, feel free to take a look at the resources below.</p><ul><li><a href=https://sysdig.com/blog/prometheus-metrics/>https://sysdig.com/blog/prometheus-metrics/</a></li><li><a href=https://prometheus.io/docs/guides/go-application/>https://prometheus.io/docs/guides/go-application/</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://linuxera.org/tags/prometheus/>prometheus</a></li><li><a href=https://linuxera.org/tags/golang/>golang</a></li><li><a href=https://linuxera.org/tags/metrics/>metrics</a></li><li><a href=https://linuxera.org/tags/development/>development</a></li></ul><nav class=paginav><a class=prev href=https://linuxera.org/integrating-operators-olm/><span class=title>¬´ Prev</span><br><span>Integrating our Operators with OLM</span></a>
<a class=next href=https://linuxera.org/oauth-proxy-secure-applications-openshift/><span class=title>Next ¬ª</span><br><span>Using OpenShift OAuth Proxy to secure your Applications on OpenShift</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Enabling Prometheus Metrics on your Applications on twitter" href="https://twitter.com/intent/tweet/?text=Enabling%20Prometheus%20Metrics%20on%20your%20Applications&url=https%3a%2f%2flinuxera.org%2fprometheus-metrics-on-your-applications%2f&hashtags=prometheus%2cgolang%2cmetrics%2cdevelopment"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Enabling Prometheus Metrics on your Applications on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2flinuxera.org%2fprometheus-metrics-on-your-applications%2f&title=Enabling%20Prometheus%20Metrics%20on%20your%20Applications&summary=Enabling%20Prometheus%20Metrics%20on%20your%20Applications&source=https%3a%2f%2flinuxera.org%2fprometheus-metrics-on-your-applications%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></div></footer><div class=share-buttons><p>If this post has been helpful to you, consider <u><a target=_blank href=https://ko-fi.com/mvazce>supporting the work.</a></u></p></div><script src=https://utteranc.es/client.js repo=mvazquezc/mvazquezc.github.io issue-term=pathname label=blog-comments theme=preferred-color-scheme crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://linuxera.org/>Linuxera</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>